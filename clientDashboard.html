<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ==========================================================================
       META TAGS & DOCUMENT SETUP
       ========================================================================== -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Client Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Additional styles for the action buttons */
    .meeting-action-buttons {
      display: flex;
      gap: 8px;
    }
    
    /* Breadcrumb Navigation Styles */
    .breadcrumb-nav {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    
    .breadcrumb-link {
      color: #FF6B00;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s ease;
    }
    
    .breadcrumb-link:hover {
      color: #e55a00;
      text-decoration: underline;
    }
    
    .breadcrumb-separator {
      color: #666;
      font-weight: 400;
      margin: 0 4px;
    }
    
    .breadcrumb-current {
      color: #333;
      font-weight: 600;
    }
    
    /* Ensure secondary action bar has proper spacing */
    .secondary-action-bar {
      margin-top: 0;
      border-top: 1px solid #e0e0e0;
    }
    
    /* Adjust main container to account for secondary bar */
    .main-container {
      margin-top: 116px; /* 64px header + 52px secondary bar */
      padding-top: 24px;
    }
  </style>
</head>

<body>
  
  <!-- ==========================================================================
       HEADER WILL BE LOADED HERE BY HeaderManager
       ========================================================================== -->
  <!-- Header content will be inserted here automatically -->
  
  <!-- ==========================================================================
       MAIN CLIENT Dashboard CONTAINER
       ========================================================================== -->
  <div class="main-container">
    
    <!-- ==========================================================================
         CLIENT HEADER SECTION
         ========================================================================== -->
    <div class="client-header">
      <h1 class="client-name" id="clientNameHeader">Johnson, Peter (59)</h1>
      <a href="client-record.html" class="forward-link">View Full Record</a>
    </div>

  <!-- Client Information Section -->
  <section class="client-info">
    <h2 class="section-title">Client Information</h2>
    <div class="info-grid">
      <div class="info-item">
        <span class="info-label">First Name</span>
        <span class="info-value">Peter</span>
      </div>
      <div class="info-item">
        <span class="info-label">Middle Name</span>
        <span class="info-value"></span>
      </div>
      <div class="info-item">
        <span class="info-label">Last Name</span>
        <span class="info-value">Johnson</span>
      </div>
      <div class="info-item">
        <span class="info-label">Nickname</span>
        <span class="info-value">Pete</span>
      </div>
      <div class="info-item">
        <span class="info-label">Age</span>
        <span class="info-value">59</span>
      </div>
    </div>

    <div class="info-item" style="margin-top: 1.5rem;">
      <span class="info-label">Client Record</span>
      <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.5rem;">
        <div style="display: flex; gap: 2rem;">
          <div>
            <span class="info-label">Program</span>
            <span class="info-value" style="display: block;">Scattered Site SHP</span>
          </div>
          <div>
            <span class="info-label">Since</span>
            <span class="info-value" style="display: block;">Mar 2023</span>
          </div>
        </div>
      </div>
    </div>

    <div class="client-address" style="width: 100%;">
      <h3 class="section-title">Address Information</h3>
      <div class="address-grid">
        <div class="info-item">
          <span class="info-label">Street</span>
          <span class="info-value">123 Main St</span>
        </div>
        <div class="info-item">
          <span class="info-label">Apt</span>
          <span class="info-value">2B</span>
        </div>
        <div class="info-item">
          <span class="info-label">City</span>
          <span class="info-value">Chicago</span>
        </div>
        <div class="info-item">
          <span class="info-label">State</span>
          <span class="info-value">IL</span>
        </div>
        <div class="info-item">
          <span class="info-label">Zip</span>
          <span class="info-value">60642</span>
        </div>
      </div>
      <div class="info-item" style="margin-top: 1rem;">
        <span class="info-label">Address Notes</span>
        <span class="info-value">Entrance on side street. Buzzer #203.</span>
      </div>
    </div>
  </section>

    <!-- ==========================================================================
         CONTACT Dashboard SECTION
         ========================================================================== -->
    <section class="contact-history">
      <h2 class="section-title">Contact Dashboard</h2>
      
      <!-- Filter Controls -->
      <div class="filter-controls" style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px; flex-wrap: wrap;">
        <div style="display: flex; align-items: center; gap: 8px;">
          <label for="startDate">Start Date:</label>
          <input type="date" id="startDate" class="date-input">
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <label for="endDate">End Date:</label>
          <input type="date" id="endDate" class="date-input">
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <label for="providerFilter">Provider:</label>
          <select id="providerFilter" class="provider-select">
            <option value="">All Providers</option>
            <option value="DR">DR</option>
            <option value="EM">EM</option>
            <option value="AL">AL</option>
            <option value="JM">JM</option>
          </select>
        </div>
        <button id="applyFiltersBtn" class="apply-filters-btn">Apply Filters</button>
        <button id="clearFiltersBtn" class="clear-filters-btn">Clear</button>
      </div>

      <div class="history-header">
        <button class="add-checkin-btn" id="addFollowupBtn">Add CM Followup</button>
        <button class="add-checkin-btn" id="addOTFollowupBtn" style="margin-left: 8px;">Add OT Followup</button>
      </div>

      <div class="table-container">
        <table class="contact-table">
          <thead>
            <tr>
              <th class="sortable">Date ↓</th>
              <th>Location ↓</th>
              <th>Resources Given ↓</th>
              <th>Services Provided ↓</th>
              <th>Provider ↓</th>
              <th>IDHS Categories ↓</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>01-29-2024</td>
              <td>Engagement Center</td>
              <td>Food</td>
              <td>OT</td>
              <td>Alexandra Perry</td>
              <td>Health Contact - Consultation / Individual</td>
            </tr>
            <tr>
              <td>12-15-2023</td>
              <td>Engagement Center</td>
              <td>Food, $5 Transit Card</td>
              <td>Case Management</td>
              <td>Elena Ahmed</td>
              <td>Health Contact - Consultation / Individual</td>
            </tr>
            <tr>
              <td>11-02-2023</td>
              <td>Home Visit</td>
              <td>Home Goods</td>
              <td>Follow-up Services</td>
              <td>Jamal Silva</td>
              <td>Housing - Follow-up Services</td>
            </tr>
            <tr>
              <td>10-10-2023</td>
              <td>Engagement Center</td>
              <td>Food, Hygiene Products</td>
              <td>OT</td>
              <td>Alexandra Perry</td>
              <td>Health Contact - Consultation / Individual</td>
            </tr>
            <tr>
              <td>09-05-2023</td>
              <td>Phone/Text/Email</td>
              <td>None</td>
              <td>Housing Location / Inspection</td>
              <td>Sonia Singh</td>
              <td>Housing - Location / Inspection</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- ==========================================================================
       JAVASCRIPT - External Script Files
       ========================================================================== -->
  
  <!-- Load dependency scripts first -->
  <script src="page-configs.js"></script>
  <script src="header-manager.js"></script>
  
  <!-- ==========================================================================
       JAVASCRIPT - Client Dashboard Functionality
       ========================================================================== -->
  <script>
    // ==========================================================================
    // PAGE CONFIGURATION - Custom config for Client Dashboard
    // ==========================================================================

    // Custom page configuration for client Dashboard
const clientDashboardPageConfig = {
  activeTab: null,  // This keeps all nav tabs inactive as intended
  features: {
    search: false  // No search needed on history page
  },
  secondaryBar: {
    leftContent: {
      type: 'breadcrumbs',
      breadcrumbs: [
        { text: 'Contact Log', href: 'index.html' },
        { text: 'Client Dashboard: Johnson, Peter (59)' }  // No href = current page
      ]
    },
    rightContent: {
      type: 'buttons',
      buttons: [
        { text: 'Export', id: 'exportHistoryBtn' },
        { text: 'Print', id: 'printReportBtn' }
      ]
    }
  }
};

    // ==========================================================================
    // MAIN INITIALIZATION
    // ==========================================================================

    // Initialize header when DOM content is loaded
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('DOM Content Loaded - Starting header initialization');
      
      // Wait a moment to ensure all scripts are loaded
      await new Promise(resolve => setTimeout(resolve, 100));
      
      // Initialize header with custom configuration
      try {
        // Wait for HeaderManager to be available
        let attempts = 0;
        while (!window.HeaderManager && attempts < 10) {
          await new Promise(resolve => setTimeout(resolve, 100));
          attempts++;
        }
        
        if (!window.HeaderManager) {
          throw new Error('HeaderManager not available after waiting');
        }
        
        if (typeof window.HeaderManager.init !== 'function') {
          throw new Error('HeaderManager.init is not a function');
        }
        
        // Initialize with custom config
        await window.HeaderManager.init(clientDashboardPageConfig);
        console.log('Header loaded successfully for clientLogHistory');
        
        // Apply custom navigation state after header loads
        applyCustomNavigationState();
        
        
      } catch (error) {
        console.error('Header initialization failed:', error);
      }
      
      // Initialize page-specific functionality
      initializeclientDashboard();
    });

    // ==========================================================================
    // CUSTOM NAVIGATION STATE SETUP
    // ==========================================================================

    function applyCustomNavigationState() {
      // Set all navigation tabs to inactive state
      const navTabs = document.querySelectorAll('.nav-tab');
      navTabs.forEach(tab => {
        tab.classList.remove('nav-tab-active');
        tab.classList.add('nav-tab-inactive');
        
        // Convert spans back to links if needed
        if (tab.tagName === 'SPAN') {
          const link = document.createElement('a');
          link.href = getNavTabHref(tab.textContent.trim());
          link.className = tab.className;
          link.textContent = tab.textContent;
          tab.parentNode.replaceChild(link, tab);
        }
      });
      
      console.log('Applied "No Active State" navigation configuration');
    }

    function getNavTabHref(tabText) {
      const navMap = {
        'CONTACT LOG': 'index.html',
        'OUTREACH': 'outreach.html',
        'CM/OT': 'cm-ot.html',
        'DASHBOARD': 'dashboard.html'
      };
      return navMap[tabText] || '#';
    }


    // ==========================================================================
    // CLIENT Dashboard INITIALIZATION
    // ==========================================================================

    function initializeclientDashboard() {
      console.log('Initializing client dashboard functionality...');
      
      // Store client name for passing to the new page
      window.currentClientName = document.getElementById('clientNameHeader').textContent.trim();
      
      // Add CM Followup button functionality - open in new tab
      const addFollowupBtn = document.getElementById('addFollowupBtn');
      if (addFollowupBtn) {
        addFollowupBtn.addEventListener('click', function() {
          openFollowupInNewTab();
        });
      }
      
      // Add OT Followup button functionality - open in new tab
      const addOTFollowupBtn = document.getElementById('addOTFollowupBtn');
      if (addOTFollowupBtn) {
        addOTFollowupBtn.addEventListener('click', function() {
          openFollowupInNewTab('OT');
        });
      }
      
      // Make table rows clickable to view details
      const tableRows = document.querySelectorAll('.contact-table tbody tr');
      tableRows.forEach(row => {
        row.style.cursor = 'pointer';
        row.addEventListener('click', function() {
          const date = this.cells[0].textContent;
          // In a real implementation, this would open a read-only view of the meeting
          alert(`Viewing meeting details for ${date}`);
        });
      });
      
      // Function to open the followup form in a new tab
      function openFollowupInNewTab(type = 'CM') {
        // Example URL - adjust as needed for your system
        const followupUrl = `followup-form.html?client=${encodeURIComponent(window.currentClientName)}&type=${type}`;
        window.open(followupUrl, '_blank');
      }

      // Add New Contact Log button functionality
      const addNewLogBtn = document.getElementById('addNewLogBtn');
      if (addNewLogBtn) {
        addNewLogBtn.addEventListener('click', function() {
          // In a real implementation, this would open the contact log form
          const contactLogUrl = `contact-log-form.html?client=${encodeURIComponent(window.currentClientName)}`;
          window.open(contactLogUrl, '_blank');
        });
      }

      // Filter functionality
      const applyFiltersBtn = document.getElementById('applyFiltersBtn');
      const clearFiltersBtn = document.getElementById('clearFiltersBtn');
      
      if (applyFiltersBtn) {
        applyFiltersBtn.addEventListener('click', function() {
          applyFilters();
        });
      }
      
      if (clearFiltersBtn) {
        clearFiltersBtn.addEventListener('click', function() {
          clearFilters();
        });
      }

      console.log('client dashboard functionality initialized');
    }

    // ==========================================================================
    // FILTER FUNCTIONS
    // ==========================================================================

    function applyFilters() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      const provider = document.getElementById('providerFilter').value;
      
      console.log('Applying filters:', { startDate, endDate, provider });
      
      // In a real implementation, this would filter the table data
      // For now, just show an alert
      alert('Filters applied (demo mode)');
    }

    function clearFilters() {
      document.getElementById('startDate').value = '';
      document.getElementById('endDate').value = '';
      document.getElementById('providerFilter').value = '';
      
      console.log('Filters cleared');
      
      // In a real implementation, this would reset the table to show all data
      alert('Filters cleared (demo mode)');
    }

  </script>
</body>
</html>
