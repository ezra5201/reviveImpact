<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ==========================================================================
       META TAGS & DOCUMENT SETUP
       ========================================================================== -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Client Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Additional styles for the action buttons */
    .meeting-action-buttons {
      display: flex;
      gap: 8px;
    }
    
    /* Breadcrumb Navigation Styles */
    .breadcrumb-nav {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    
    .breadcrumb-link {
      color: #FF6B00;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s ease;
    }
    
    .breadcrumb-link:hover {
      color: #e55a00;
      text-decoration: underline;
    }
    
    .breadcrumb-separator {
      color: #666;
      font-weight: 400;
      margin: 0 4px;
    }
    
    .breadcrumb-current {
      color: #333;
      font-weight: 600;
    }
    
    /* Ensure secondary action bar has proper spacing */
    .secondary-action-bar {
      margin-top: 0;
      border-top: 1px solid #e0e0e0;
    }
    
    /* Adjust main container to account for secondary bar */
    .main-container {
      margin-top: 116px; /* 64px header + 52px secondary bar */
      padding-top: 24px;
    }
  </style>
</head>

<body>
  
  <!-- ==========================================================================
       HEADER WILL BE LOADED HERE BY HeaderManager
       ========================================================================== -->
  <!-- Header content will be inserted here automatically -->
  
  <!-- ==========================================================================
       MAIN CLIENT Dashboard CONTAINER
       ========================================================================== -->
  <div class="main-container">
    
    <!-- ==========================================================================
         CLIENT HEADER SECTION
         ========================================================================== -->
    <div class="client-header">
      <h1 class="client-name" id="clientNameHeader">Loading...</h1>
      <a href="client-record.html" class="forward-link">View Full Record</a>
    </div>

 <!-- Client Information Section -->
  <section class="client-info">
    <h2 class="section-title">Client Information</h2>
    <div class="info-grid">
      <div class="info-item">
        <span class="info-label">First Name</span>
        <span class="info-value">Peter</span>
      </div>
      <div class="info-item">
        <span class="info-label">Middle Name</span>
        <span class="info-value"></span>
      </div>
      <div class="info-item">
        <span class="info-label">Last Name</span>
        <span class="info-value">Johnson</span>
      </div>
      <div class="info-item">
        <span class="info-label">Nickname</span>
        <span class="info-value">Pete</span>
      </div>
      <div class="info-item">
        <span class="info-label">Age</span>
        <span class="info-value">59</span>
      </div>
    </div>

    <div class="info-item" style="margin-top: 1.5rem;">
      <span class="info-label">Client Record</span>
      <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.5rem;">
        <div style="display: flex; gap: 2rem;">
          <div>
            <span class="info-label">Program</span>
            <span class="info-value" style="display: block;">Scattered Site SHP</span>
          </div>
          <div>
            <span class="info-label">Since</span>
            <span class="info-value" style="display: block;">Mar 2023</span>
          </div>
        </div>
      </div>
    </div>

    <div class="client-address" style="width: 100%;">
      <h3 class="section-title">Address Information</h3>
      <div class="address-grid">
        <div class="info-item">
          <span class="info-label">Street</span>
          <span class="info-value">123 Main St</span>
        </div>
        <div class="info-item">
          <span class="info-label">Apt</span>
          <span class="info-value">2B</span>
        </div>
        <div class="info-item">
          <span class="info-label">City</span>
          <span class="info-value">Chicago</span>
        </div>
        <div class="info-item">
          <span class="info-label">State</span>
          <span class="info-value">IL</span>
        </div>
        <div class="info-item">
          <span class="info-label">Zip</span>
          <span class="info-value">60642</span>
        </div>
      </div>
      <div class="info-item" style="margin-top: 1rem;">
        <span class="info-label">Address Notes</span>
        <span class="info-value">Entrance on side street. Buzzer #203.</span>
      </div>
    </div>
  </section>

 <!-- ==========================================================================
       CONTACT LOG HISTORY SECTION
       ========================================================================== -->
  <section class="contact-history">
    <h2 class="section-title">Contact Log History</h2>
    
    <!-- Filter Controls -->
    <div class="filter-controls" style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px; flex-wrap: wrap;">
      <div style="display: flex; align-items: center; gap: 8px;">
        <label for="startDate">Start Date:</label>
        <input type="date" id="startDate" class="date-input">
      </div>
      <div style="display: flex; align-items: center; gap: 8px;">
        <label for="endDate">End Date:</label>
        <input type="date" id="endDate" class="date-input">
      </div>
      <div style="display: flex; align-items: center; gap: 8px;">
        <label for="providerFilter">Provider:</label>
        <select id="providerFilter" class="provider-select">
          <option value="">All Providers</option>
          <option value="DR">DR</option>
          <option value="EM">EM</option>
          <option value="AL">AL</option>
          <option value="JM">JM</option>
        </select>
      </div>
      <button id="applyFiltersBtn" class="apply-filters-btn">Apply Filters</button>
      <button id="clearFiltersBtn" class="clear-filters-btn">Clear</button>
    </div>

    <div class="history-header">
      <button class="add-checkin-btn" id="addFollowupBtn">Add CM Followup</button>
      <button class="add-checkin-btn" id="addOTFollowupBtn" style="margin-left: 8px;">Add OT Followup</button>
    </div>

    <div class="table-container">
      <table class="contact-table">
        <thead>
          <tr>
            <th class="sortable">Date ↓</th>
            <th>Location ↓</th>
            <th>Resources Given ↓</th>
            <th>Services Provided ↓</th>
            <th>Provider ↓</th>
            <th>IDHS Categories ↓</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>01-29-2024</td>
            <td>Engagement Center</td>
            <td>Food</td>
            <td>OT</td>
            <td>Alexandra Perry</td>
            <td>Health Contact - Consultation / Individual</td>
          </tr>
          <tr>
            <td>12-28-2023</td>
            <td>Engagement Center</td>
            <td>Food, Shower Supplies</td>
            <td>Housing</td>
            <td>Jennifer Martinez</td>
            <td>Health Contact - Consultation / Individual</td>
          </tr>
          <tr>
            <td>12-15-2023</td>
            <td>Engagement Center</td>
            <td>Food, $5 Transit Card</td>
            <td>Case Management</td>
            <td>Elena Ahmed</td>
            <td>Health Contact - Consultation / Individual</td>
          </tr>
          <tr>
            <td>11-02-2023</td>
            <td>Home Visit</td>
            <td>Home Goods</td>
            <td>Follow-up Services</td>
            <td>Jamal Silva</td>
            <td>Housing - Follow-up Services</td>
          </tr>
          <tr>
            <td>10-10-2023</td>
            <td>Engagement Center</td>
            <td>Food, Hygiene Products</td>
            <td>OT</td>
            <td>Alexandra Perry</td>
            <td>Health Contact - Consultation / Individual</td>
          </tr>
          <tr>
            <td>09-05-2023</td>
            <td>Phone/Text/Email</td>
            <td>None</td>
            <td>Housing Location / Inspection</td>
            <td>Sonia Singh</td>
            <td>Housing - Location / Inspection</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</div>

  <!-- ==========================================================================
       JAVASCRIPT - External Script Files
       ========================================================================== -->
  
  <!-- Load dependency scripts first -->
  <script src="page-configs.js"></script>
  <script src="header-manager.js"></script>
  <script src="index-scripts.js"></script>
  
  <!-- ==========================================================================
       JAVASCRIPT - Client Dashboard Functionality
       ========================================================================== -->
  <script>
    // ==========================================================================
    // CLIENT DATA RETRIEVAL FUNCTIONS
    // ==========================================================================

    // Function to get client ID from URL parameters
   function getClientNameFromUrl() {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get('clientName');
}

    // Function to fetch client data by ID
    async function fetchClientData(clientId) {
      // Mock client data - replace with actual API call
      const clientData = {
        '172879': {
          clientId: '172879',
          firstName: 'Robert',
          lastName: 'Smith',
          age: '54'
        },
        '171009': {
          clientId: '171009',
          firstName: 'James',
          lastName: 'Johnson',
          age: '59'
        },
        '421138': {
          clientId: '421138',
          firstName: 'Peter',
          lastName: 'Johnson',
          age: '59'
        },
        '257421': {
          clientId: '257421',
          firstName: 'Michael',
          lastName: 'Davis',
          age: '60'
        },
        '280784': {
          clientId: '280784',
          firstName: 'Carlos',
          lastName: 'Rodriguez',
          age: '55'
        }
      };

      // In real application, replace with:
      // const response = await fetch(`/api/clients/${clientId}`);
      // return await response.json();
      
      return clientData[clientId] || null;
    }

    // ==========================================================================
    // DYNAMIC CLIENT NAME UPDATE FUNCTIONS
    // ==========================================================================

    // Function to format client name display
    function formatClientDisplay(client) {
      if (!client) return 'Unknown Client';
      return `${client.lastName}, ${client.firstName} (${client.age})`;
    }

    // Function to update all client name elements on the page
    function updateClientNameElements(clientDisplayName) {
      // Update main header
      const clientNameHeader = document.getElementById('clientNameHeader');
      if (clientNameHeader) {
        clientNameHeader.textContent = clientDisplayName;
      }

      // Update breadcrumb
      const breadcrumbCurrent = document.querySelector('.breadcrumb-current');
      if (breadcrumbCurrent) {
        breadcrumbCurrent.textContent = `Client History: ${clientDisplayName}`;
      }

      // Update page title
      document.title = `Client Dashboard - ${clientDisplayName}`;
    }

    // ==========================================================================
    // PAGE INITIALIZATION WITH DYNAMIC CLIENT DATA
    // ==========================================================================

    // Modified page configuration function
    function createDynamicPageConfig(clientDisplayName) {
      return {
        activeTab: null,
        features: {
          search: false
        },
        secondaryBar: {
          leftContent: {
            type: 'breadcrumbs',
            breadcrumbs: [
              { text: 'Contact Log', href: 'index.html' },
              { text: `Client History: ${clientDisplayName}`, current: true }
            ]
          },
          rightActions: ['exportHistory', 'printReport']
        }
      };
    }

    // Modified secondary action bar setup
    function setupDynamicSecondaryActionBar(clientDisplayName) {
      let secondaryBar = document.getElementById('secondaryActionBar');
      if (!secondaryBar) {
        secondaryBar = document.createElement('div');
        secondaryBar.id = 'secondaryActionBar';
        secondaryBar.className = 'secondary-action-bar';
        
        const header = document.querySelector('header');
        if (header) {
          header.insertAdjacentElement('afterend', secondaryBar);
        }
      }

      // Setup breadcrumbs with dynamic client name
      const leftSection = document.createElement('div');
      leftSection.className = 'secondary-action-bar-left';
      leftSection.innerHTML = `
        <nav class="breadcrumb-nav">
          <a href="index.html" class="breadcrumb-link">Contact Log</a>
          <span class="breadcrumb-separator">></span>
          <span class="breadcrumb-current">Client History: ${clientDisplayName}</span>
        </nav>
      `;

      // Setup right actions
      const rightSection = document.createElement('div');
      rightSection.className = 'secondary-action-bar-right';
      rightSection.innerHTML = `
        <button class="btn btn-secondary" id="exportHistoryBtn">Export History</button>
        <button class="btn btn-secondary" id="printReportBtn">Print Report</button>
      `;

      // Clear and populate secondary bar
      secondaryBar.innerHTML = '';
      secondaryBar.appendChild(leftSection);
      secondaryBar.appendChild(rightSection);
    }

    // ==========================================================================
    // SUPPORTING FUNCTIONS (kept from original)
    // ==========================================================================

    function applyCustomNavigationState() {
      // Set all navigation tabs to inactive state
      const navTabs = document.querySelectorAll('.nav-tab');
      navTabs.forEach(tab => {
        tab.classList.remove('nav-tab-active');
        tab.classList.add('nav-tab-inactive');
        
        // Convert spans back to links if needed
        if (tab.tagName === 'SPAN') {
          const link = document.createElement('a');
          link.href = getNavTabHref(tab.textContent.trim());
          link.className = tab.className;
          link.textContent = tab.textContent;
          tab.parentNode.replaceChild(link, tab);
        }
      });
      
      console.log('Applied "No Active State" navigation configuration');
    }

    function getNavTabHref(tabText) {
      const navMap = {
        'CONTACT LOG': 'index.html',
        'OUTREACH': 'outreach.html',
        'CM/OT': 'cm-ot.html',
        'DASHBOARD': 'dashboard.html'
      };
      return navMap[tabText] || '#';
    }

    function initializeClientHistory() {
      console.log('Client history functionality initialized');
      
      // Add event listeners for export and print buttons
      document.addEventListener('click', function(e) {
        if (e.target.id === 'exportHistoryBtn') {
          console.log('Export history clicked');
          // Add export functionality here
        }
        
        if (e.target.id === 'printReportBtn') {
          console.log('Print report clicked');
          // Add print functionality here
        }
      });
    }

    // Function to populate client info section with dynamic data
    function populateClientInfoSection(clientData) {
      if (!clientData) return;
      
      // Update client info fields if they exist
      const infoFields = {
        firstName: clientData.firstName || '',
        lastName: clientData.lastName || '',
        age: clientData.age || '',
        nickname: clientData.nickname || '',
        // Add other fields as needed
      };
      
      Object.entries(infoFields).forEach(([fieldName, value]) => {
        const valueElements = document.querySelectorAll(`.info-value`);
        valueElements.forEach(element => {
          const label = element.previousElementSibling;
          if (label && label.textContent.toLowerCase().includes(fieldName.toLowerCase())) {
            element.textContent = value;
          }
        });
      });
    }

    // ==========================================================================
    // MODIFIED MAIN INITIALIZATION
    // ==========================================================================


    document.addEventListener('DOMContentLoaded', async function() {
      console.log('DOM Content Loaded - Starting dynamic client dashboard initialization');

      // Get client Name from URL
// Get client Name from URL
const clientName = getClientNameFromUrl();

if (!clientName) {
  console.error('No client name provided in URL');
  alert('No client specified. Redirecting to contact log.');
  window.location.href = 'index.html';
  return;
}

// Use the client name directly from URL parameter (it's already formatted)
const clientDisplayName = clientName;

// Update all client name elements immediately
updateClientNameElements(clientDisplayName);

// Wait for scripts to load
await new Promise(resolve => setTimeout(resolve, 100));

// Initialize header with dynamic configuration
let attempts = 0;
while (!window.HeaderManager && attempts < 10) {
  await new Promise(resolve => setTimeout(resolve, 100));
  attempts++;
}

if (!window.HeaderManager) {
  throw new Error('HeaderManager not available after waiting');
}

// Create dynamic page config
const dynamicPageConfig = createDynamicPageConfig(clientDisplayName);

// Initialize header
await window.HeaderManager.init(dynamicPageConfig);
console.log('Header loaded successfully for client:', clientDisplayName);

// Apply custom navigation state
applyCustomNavigationState();

// Setup secondary action bar with dynamic client name
setupDynamicSecondaryActionBar(clientDisplayName);

// Initialize other page functionality
initializeClientHistory();

// Note: Removed populateClientInfoSection since we don't have detailed client data
// The client info section will need to be populated differently or removed

} catch (error) {
  console.error('Client dashboard initialization failed:', error);
  alert('Error loading client dashboard. Please try again.');
}
  </script>

</body>
</html>
